# Exercise 2: Creating a 3D model of your object, inside and out

The goal of this exercise is to: 
* Learn how to segment your data to create a 3D model
* Exporting your segmented data and model
* Opening your 3D model in other programs
* Smooth and edit 3D surfaces 

This exercise will focus on how to take your data from a set of TIFF images with a variety of different gray scale values (i.e., a volume) to a 3D model. This requires that you assign specific voxels to certain materials; this process is referred to as segmentation. For instance, the computer does not actually know that the lighter voxels are ceramic and the darker ones are empty space, it is only our knowledge and context that we recognize that this is the case. 

In this exercise, you are going to use various tools in the Segment Editor module of 3D Slicer to create two 3D models of a ceramic vessel. You will specifically use Dataset 1, the bird whistling pot; unless you have a higher-powered computer we recommend that you use the downsampled dataset (either that you downloaded from MorphoSource or that you created in Exercise 1). 

#### Thresholding	
First, load your data into 3D Slicer. Navigate to the ImageStacks module and browse to the location of your files. Select one of the images, and make sure the voxel size is correct (see the Spacing information). If the voxel size is not accurate, refer to the metadata for your image stack and find the voxel size. Copy those values into the Spacing section (x, y, and z dimensions) 

Once your data is loaded, use the magnifying tool to navigate to the Segment Editor module. There are many different tools in this module and which ones you use will be a function of the materials you are working with and the kind of questions you’re interested in. Go ahead and rename your segmentation to something you will remember, by clicking the “Rename Current Segmentation” choice in the Segmentation drop-down menu. Click the Add button to add a few segments to your segmentation. You can rename the segments by double-clicking on the text. You will start with the threshold tool (you can see the names of these effect options in the left hand menu). This tool uses a volume-wide grayscale cutoff (or ‘threshold’) to define voxels in a segment. Start by telling it that any voxel with a value between 80 and 255 (for an 8-bit volume) is part of segment 1. As you change the slider, you should see a preview in the orthogonal slice viewers. What you will notice is that there doesn’t seem to be a value that consistently selects only clay across the whole volume. Too high and you are only selecting the most opaque clay, too low and you start selecting some of the artifacts surrounding the base of the vessel. So 60 seems to be a good compromise, though you may wish to apply a slightly different threshold depending on your goals. One thing to note here is that this threshold slightly overselects the ceramics in some places and under selects in others. Click Apply to add your selection to segment 1. If you want to see what the segment looks like, click the button named “Show 3D”. This can be improved upon. Note that it helps to turn off 3D view (by deselecting “Show 3D”) when you are segmenting; because image rendering in 3D requires so much computing power, segmenting will go faster with this setting off. Depending on your dataset size, it may take a moment for the 3D view to appear; when it does if you still have your volume rendering showing it may only barely overlap that gray volume rendering. You can turn off the volume rendering by going back to the Volume Rendering module and closing the eye button. 

You may notice in your slices that there are some small holes in the model that were not included in the thresholding. The best way to fill these is to use the Margin function to grow and shrink the selection so that the internal spaces of the object are filled. This function allows you to set the Margin size, which is the area by which you want the selection to grow or shrink. Set this so that the Margin size is about 1.00 mm, and make sure the Operation is set to Grow. Click Apply, and once this is done, scroll through the image stack; you should notice that many of the small spaces are now filled and that the selection has expanded out into the air surrounding the object. You may want to perform one more Grow operation to make sure everything gets filled. Next, you will want to Shrink your selection by the same amount that you grew it, so the boundaries of your selection return to roughly match the outline of the object.  Scrolling through your image stack, you will notice that, though this Grow/Shrink operation mostly filled the internal structure of the object, though there may some large holes remaining. 

Your end result should look something like this:

